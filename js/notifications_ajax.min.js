(function(t,o){function n(s){var e=this,u=o('<div />'),a=o('<div />'),c=null;this.options=o.extend({},n.default,s);this.showNotification=function(i,s,a,n){u.queue(function(){var c=this;setTimeout(function(){o(c).dequeue()},100);var u=new Notification(s,{body:a,icon:e.options.icon});if(typeof(n)!='undefined'&&n!=null){u.url_item=CFG_GLPI.url_base+'/'+(n);u.onclick=function(i){i.preventDefault();t.open(this.url_item,'_blank')}};o.ajax({url:CFG_GLPI.root_doc+'/ajax/notifications_ajax.php',method:'GET',data:{delete:i}})})};this.playAudio=function(i){if(!i||!('Audio' in t)){return!1};var n=new Audio();o(n).append(o('<source />',{src:CFG_GLPI.root_doc+'/sound/'+i+'.mp3',type:'audio/mpeg'}));o(n).append(o('<source />',{src:CFG_GLPI.root_doc+'/sound/'+i+'.ogg',type:'audio/ogg'}));a.queue(function(){var i=this;n.onended=function(){o(i).dequeue()};n.play()})};this.checkNewNotifications=function(){if(!e.isSupported()){return!1};var t=o.getJSON(CFG_GLPI.root_doc+'/ajax/notifications_ajax.php');t.done(function(o){if(o){for(i=0;i<o.length;i++){var t=o[i];e.showNotification(t.id,t.title,t.body,t.url)};if(e.options.sound){e.playAudio(e.options.sound)}};setTimeout(e.checkNewNotifications,e.options.interval)})};this.startMonitoring=function(){e.checkNewNotifications()};this.checkPermission=function(){if(Notification.permission==='granted'){this.startMonitoring()}
else if(Notification.permission!=='denied'){Notification.requestPermission(function(i){if(i==='granted'){this.startMonitoring()}})}};this.start=function(){if(!this.isSupported()){return!1};this.checkPermission()};this.isSupported=function(){return'Notification' in t&&'localStorage' in t}};n.default={interval:10000,sound:!1,icon:!1};t.GLPINotificationsAjax=n})(window,jQuery);